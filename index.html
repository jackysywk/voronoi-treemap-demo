<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5ç‚¹ Weighted Voronoi æ¼”ç¤º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        canvas {
            border: 2px solid #333;
            display: block;
            margin: 20px auto;
            background: white;
            cursor: crosshair;
        }
        .controls {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 20px 0;
            gap: 15px;
        }
        .seed-control {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #ddd;
            min-width: 180px;
        }
        .seed-control h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }
        .weight-slider {
            width: 100%;
            margin: 10px 0;
        }
        .weight-value {
            display: inline-block;
            width: 50px;
            text-align: center;
            font-weight: bold;
            background: #e3f2fd;
            padding: 3px 8px;
            border-radius: 4px;
        }
        .buttons {
            text-align: center;
            margin: 20px 0;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #1976D2;
        }
        button.secondary {
            background: #4CAF50;
        }
        button.secondary:hover {
            background: #45a049;
        }
        .info {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .stat-item {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid;
        }
        .stat-item strong {
            display: block;
            margin-bottom: 5px;
        }
        .instructions {
            background: #fff3e0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
        }
        .instructions h3 {
            margin-top: 0;
        }
        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .instructions li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ 5ç‚¹ Weighted Voronoi Diagram (Power Diagram)</h1>
        
        <div class="info">
            <strong>ğŸ“Œ Power Diagram ç‰¹æ€§ï¼š</strong>
            <p>â€¢ ä½¿ç”¨å…¬å¼ï¼š<code>dÂ² = (x-sx)Â² + (y-sy)Â² - weight</code></p>
            <p>â€¢ è¾¹ç•Œæ˜¯<strong>ç›´çº¿</strong>ï¼ˆä¸æ˜¯æ›²çº¿ï¼ï¼‰</p>
            <p>â€¢ æƒé‡è¶Šå¤§ â†’ åŒºåŸŸè¶Šå¤§</p>
        </div>

        <canvas id="canvas" width="800" height="600"></canvas>

        <div class="controls" id="controls"></div>

        <div class="buttons">
            <button onclick="resetSeeds()">ğŸ”„ é‡ç½®ä½ç½®</button>
            <button onclick="resetWeights()">âš–ï¸ é‡ç½®æƒé‡</button>
            <button class="secondary" onclick="iterateToCentroid()">â¡ï¸ ç§»åŠ¨åˆ°è´¨å¿ƒï¼ˆ1æ­¥ï¼‰</button>
            <button class="secondary" onclick="toggleAnimation()">
                <span id="animText">â–¶ï¸ è‡ªåŠ¨æ”¶æ•›</span>
            </button>
            <button onclick="randomize()">ğŸ² éšæœºåŒ–</button>
        </div>

        <div class="stats" id="stats"></div>

        <div class="instructions">
            <h3>ğŸ® æ“ä½œè¯´æ˜ï¼š</h3>
            <ul>
                <li><strong>æ‹–åŠ¨æ»‘æ†</strong> - è°ƒæ•´å„ç‚¹æƒé‡ï¼Œè§‚å¯ŸåŒºåŸŸå¤§å°å˜åŒ–</li>
                <li><strong>ç‚¹å‡»ç”»å¸ƒ</strong> - ç§»åŠ¨æœ€è¿‘çš„ç§å­ç‚¹</li>
                <li><strong>ç§»åŠ¨åˆ°è´¨å¿ƒ</strong> - æ‰§è¡Œä¸€æ­¥ Lloyd è¿­ä»£</li>
                <li><strong>è‡ªåŠ¨æ”¶æ•›</strong> - æŒç»­è¿­ä»£ç›´åˆ°è¾¾åˆ° CVT çŠ¶æ€</li>
                <li><strong>éšæœºåŒ–</strong> - éšæœºè®¾ç½®æƒé‡å’Œä½ç½®</li>
            </ul>
            <p><strong>ğŸ’¡ è¯•è¯•çœ‹ï¼š</strong>è®¾ç½®æƒé‡æ¯”ä¾‹ä¸º 1:2:3:4:5ï¼Œè§‚å¯Ÿé¢ç§¯æ˜¯å¦æ¥è¿‘æ­¤æ¯”ä¾‹ï¼</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const w = canvas.width;
        const h = canvas.height;

        // 5ä¸ªç§å­ç‚¹ï¼Œä¸åŒé¢œè‰²
        const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8'];
        let seeds = [
            { x: 200, y: 200, weight: 50, color: colors[0], name: 'ç§å­ 1' },
            { x: 600, y: 200, weight: 50, color: colors[1], name: 'ç§å­ 2' },
            { x: 400, y: 400, weight: 50, color: colors[2], name: 'ç§å­ 3' },
            { x: 200, y: 500, weight: 50, color: colors[3], name: 'ç§å­ 4' },
            { x: 600, y: 500, weight: 50, color: colors[4], name: 'ç§å­ 5' }
        ];

        let animating = false;
        let animationFrame;
        let draggedSeed = null;

        // Power Distance (ä½¿ç”¨å¹³æ–¹è·ç¦»)
        function powerDistance(px, py, seed) {
            const dx = px - seed.x;
            const dy = py - seed.y;
            const distSq = dx * dx + dy * dy;
            // æŠŠæƒé‡ä¹˜ä»¥æ›´å¤§çš„ç³»æ•°ï¼
            return distSq - seed.weight * 500;  // æ”¹æˆ 500 æˆ–æ›´å¤§
        }

        // æ‰¾å‡ºæœ€è¿‘çš„ç§å­ç‚¹ï¼ˆPower Distanceï¼‰
        function closestSeed(px, py) {
            let minDist = Infinity;
            let closest = 0;
            
            seeds.forEach((seed, i) => {
                const dist = powerDistance(px, py, seed);
                if (dist < minDist) {
                    minDist = dist;
                    closest = i;
                }
            });
            
            return closest;
        }

        // åˆ›å»ºæ§åˆ¶é¢æ¿
        function createControls() {
            const controlsDiv = document.getElementById('controls');
            controlsDiv.innerHTML = '';
            
            seeds.forEach((seed, i) => {
                const div = document.createElement('div');
                div.className = 'seed-control';
                div.style.borderColor = seed.color;
                div.innerHTML = `
                    <h3 style="color: ${seed.color}">â— ${seed.name}</h3>
                    <label>
                        æƒé‡: <span class="weight-value" id="weight-${i}">${seed.weight}</span>
                        <input type="range" class="weight-slider" 
                               id="slider-${i}" 
                               min="10" max="150" value="${seed.weight}">
                    </label>
                `;
                controlsDiv.appendChild(div);
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬
                document.getElementById(`slider-${i}`).addEventListener('input', function(e) {
                    seeds[i].weight = parseInt(e.target.value);
                    document.getElementById(`weight-${i}`).textContent = e.target.value;
                    draw();
                });
            });
        }

        // ç»˜åˆ¶ Voronoi å›¾
        function draw() {
            ctx.clearRect(0, 0, w, h);

            // è®¡ç®—é¢ç§¯
            let areas = new Array(seeds.length).fill(0);

            // å¯¹æ¯ä¸ªåƒç´ ç‚¹ç€è‰²
            const imageData = ctx.createImageData(w, h);
            
            for (let y = 0; y < h; y++) {
                for (let x = 0; x < w; x++) {
                    const idx = closestSeed(x, y);
                    areas[idx]++;
                    
                    const color = seeds[idx].color;
                    const rgb = hexToRgb(color);
                    const i = (y * w + x) * 4;
                    imageData.data[i] = rgb.r;
                    imageData.data[i + 1] = rgb.g;
                    imageData.data[i + 2] = rgb.b;
                    imageData.data[i + 3] = 120; // åŠé€æ˜
                }
            }
            
            ctx.putImageData(imageData, 0, 0);

            // ç»˜åˆ¶è¾¹ç•Œçº¿
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let y = 0; y < h - 1; y++) {
                for (let x = 0; x < w - 1; x++) {
                    const current = closestSeed(x, y);
                    const right = closestSeed(x + 1, y);
                    const down = closestSeed(x, y + 1);
                    
                    if (current !== right) {
                        ctx.moveTo(x + 1, y);
                        ctx.lineTo(x + 1, y + 1);
                    }
                    if (current !== down) {
                        ctx.moveTo(x, y + 1);
                        ctx.lineTo(x + 1, y + 1);
                    }
                }
            }
            ctx.stroke();

            // ç»˜åˆ¶ç§å­ç‚¹
            seeds.forEach((seed, i) => {
                // ç”»åœ†
                ctx.fillStyle = seed.color;
                ctx.beginPath();
                ctx.arc(seed.x, seed.y, 10, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 3;
                ctx.stroke();

                // æ ‡ç­¾
                ctx.fillStyle = '#000';
                ctx.font = 'bold 12px Arial';
                ctx.fillText(`${i + 1}`, seed.x - 4, seed.y + 4);
                
                // æƒé‡æ˜¾ç¤º
                ctx.font = 'bold 11px Arial';
                ctx.fillStyle = seed.color;
                ctx.fillText(`W=${seed.weight}`, seed.x + 15, seed.y - 15);
            });

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats(areas);
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats(areas) {
            const totalArea = areas.reduce((a, b) => a + b, 0);
            const statsDiv = document.getElementById('stats');
            statsDiv.innerHTML = '';
            
            seeds.forEach((seed, i) => {
                const percentage = (areas[i] / totalArea * 100).toFixed(1);
                const div = document.createElement('div');
                div.className = 'stat-item';
                div.style.borderColor = seed.color;
                div.innerHTML = `
                    <strong style="color: ${seed.color}">${seed.name}</strong>
                    æƒé‡: ${seed.weight} | é¢ç§¯: ${areas[i].toLocaleString()} pxÂ² (${percentage}%)
                `;
                statsDiv.appendChild(div);
            });
        }

        // é¢œè‰²è½¬æ¢
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 0, g: 0, b: 0 };
        }

        // æ»‘é¼ äº‹ä»¶
        canvas.addEventListener('mousedown', function(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // æ‰¾æœ€è¿‘çš„ç§å­ç‚¹
            let minDist = Infinity;
            seeds.forEach((seed, i) => {
                const dist = Math.sqrt((x - seed.x) ** 2 + (y - seed.y) ** 2);
                if (dist < minDist && dist < 30) {
                    minDist = dist;
                    draggedSeed = i;
                }
            });
        });

        canvas.addEventListener('mousemove', function(e) {
            if (draggedSeed !== null) {
                const rect = canvas.getBoundingClientRect();
                const x = Math.max(10, Math.min(w - 10, e.clientX - rect.left));
                const y = Math.max(10, Math.min(h - 10, e.clientY - rect.top));
                
                seeds[draggedSeed].x = x;
                seeds[draggedSeed].y = y;
                draw();
            }
        });

        canvas.addEventListener('mouseup', function() {
            draggedSeed = null;
        });

        // é‡ç½®å‡½æ•°
        function resetSeeds() {
            seeds[0].x = 200; seeds[0].y = 200;
            seeds[1].x = 600; seeds[1].y = 200;
            seeds[2].x = 400; seeds[2].y = 400;
            seeds[3].x = 200; seeds[3].y = 500;
            seeds[4].x = 600; seeds[4].y = 500;
            draw();
        }

        function resetWeights() {
            seeds.forEach((seed, i) => {
                seed.weight = 50;
                document.getElementById(`slider-${i}`).value = 50;
                document.getElementById(`weight-${i}`).textContent = 50;
            });
            draw();
        }

        function randomize() {
            seeds.forEach((seed, i) => {
                seed.x = 100 + Math.random() * (w - 200);
                seed.y = 100 + Math.random() * (h - 200);
                seed.weight = 30 + Math.floor(Math.random() * 100);
                document.getElementById(`slider-${i}`).value = seed.weight;
                document.getElementById(`weight-${i}`).textContent = seed.weight;
            });
            draw();
        }

        // ç§»åŠ¨åˆ°è´¨å¿ƒ
        function iterateToCentroid() {
            let centroids = seeds.map(() => ({ x: 0, y: 0, count: 0 }));

            // è®¡ç®—è´¨å¿ƒ
            for (let y = 0; y < h; y += 2) {
                for (let x = 0; x < w; x += 2) {
                    const idx = closestSeed(x, y);
                    centroids[idx].x += x;
                    centroids[idx].y += y;
                    centroids[idx].count++;
                }
            }

            // ç§»åŠ¨ç§å­ç‚¹
            seeds.forEach((seed, i) => {
                if (centroids[i].count > 0) {
                    const targetX = centroids[i].x / centroids[i].count;
                    const targetY = centroids[i].y / centroids[i].count;
                    
                    seed.x += (targetX - seed.x) * 0.3;
                    seed.y += (targetY - seed.y) * 0.3;
                }
            });

            draw();
        }

        // åŠ¨ç”»
        function animate() {
            iterateToCentroid();
            
            if (animating) {
                animationFrame = requestAnimationFrame(animate);
            }
        }

        function toggleAnimation() {
            animating = !animating;
            const btn = document.getElementById('animText');
            
            if (animating) {
                btn.textContent = 'â¸ï¸ åœæ­¢';
                animate();
            } else {
                btn.textContent = 'â–¶ï¸ è‡ªåŠ¨æ”¶æ•›';
                cancelAnimationFrame(animationFrame);
            }
        }

        // åˆå§‹åŒ–
        createControls();
        draw();
    </script>
</body>
</html>